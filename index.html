<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MRFluffolFilm üé¨</title>
<style>
/* RESET */
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Helvetica Neue', Arial, sans-serif; background:#141414; color:#fff; min-height:100vh; }

/* HEADER */
header {
  background:#111;
  padding:20px;
  text-align:center;
  border-bottom:2px solid #e50914;
}
header h1 { font-size:32px; color:#e50914; margin-bottom:15px; }
#search-container { position:relative; max-width:500px; margin:0 auto; }
#searchInput {
  width:100%;
  padding:12px 45px 12px 15px;
  border-radius:25px;
  border:none;
  background:#222;
  color:#fff;
}
#searchInput::placeholder { color:#aaa; }
#searchBtn {
  position:absolute;
  right:5px;
  top:50%;
  transform:translateY(-50%);
  background:#e50914;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:20px;
  cursor:pointer;
}
#searchBtn:hover { background:#b00610; }

/* LOADING */
#loading { text-align:center; margin:20px 0; font-style:italic; color:#bbb; }

/* RISULTATI */
#results {
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:15px;
  padding:20px;
}
.card {
  background:#222;
  border-radius:10px;
  overflow:hidden;
  cursor:pointer;
  box-shadow:0 2px 8px rgba(0,0,0,0.5);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  opacity:0;
  animation: fadeIn 0.4s forwards;
}
.card:hover {
  transform:scale(1.05);
  box-shadow:0 10px 20px rgba(229,9,20,0.7);
}
.card img { width:100%; height:270px; object-fit:cover; }
.card h3 {
  text-align:center;
  padding:10px;
  font-size:14px;
  color:#eee;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* PLAYER */
#playerPage { display:none; flex-direction:column; align-items:center; padding:20px; }
#playerFrame {
  width:100%;
  max-width:960px;
  height:540px;
  border:none;
  border-radius:15px;
  box-shadow:0 0 30px rgba(229,9,20,0.7);
  margin-bottom:20px;
}
#playerControls { display:flex; flex-direction:column; align-items:center; gap:10px; margin-bottom:20px; }
#playBtn,#downloadBtn,#backBtn {
  padding:12px 25px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
  transition: all 0.3s;
}
#playBtn,#downloadBtn { background:#e50914; color:#fff; }
#playBtn:hover,#downloadBtn:hover { background:#b00610; transform:translateY(-2px); }
#backBtn { background:#444; color:#fff; }
#backBtn:hover { background:#666; transform:translateY(-2px); }

/* TV CONTROLS */
#tvControls { display:flex; gap:15px; flex-wrap:wrap; justify-content:center; color:#ccc; font-weight:600; margin-top:10px; }
#tvControls select {
  padding:5px 10px;
  border-radius:6px;
  border:none;
  background:#333;
  color:#eee;
  cursor:pointer;
}

/* ANIMAZIONI */
@keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }

/* MOBILE */
@media(max-width:700px){
  .card img{ height:200px; }
  #playerFrame{ height:270px; }
  #results { grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:10px; padding:10px; }
}
</style>
</head>
<body>

<header>
  <h1>MRFluffolFilm üé¨</h1>
  <div id="search-container">
    <input type="text" id="searchInput" placeholder="Cerca film o serie...">
    <button id="searchBtn">Cerca</button>
  </div>
</header>

<div id="loading" style="display:none;">Caricamento in corso...</div>
<div id="results"></div>

<div id="playerPage">
  <iframe id="playerFrame" allowfullscreen></iframe>
  <div id="playerControls">
    <button id="playBtn">‚ñ∂Ô∏è Riproduci</button>
    <a id="downloadLink" href="#" target="_blank"><button id="downloadBtn">‚¨áÔ∏è Scarica</button></a>
    <button id="backBtn">‚¨ÖÔ∏è Torna alla Home</button>
    <div id="tvControls">
      <label>Stagione: <select id="seasonSelect"></select></label>
      <label>Episodio: <select id="episodeSelect"></select></label>
    </div>
  </div>
</div>

<script>
const tmdbApiKey = 'a3c17d492a24a9f77acb23626404edd1';

async function searchMedia(query){
  const url=`https://api.themoviedb.org/3/search/multi?api_key=${tmdbApiKey}&language=it-IT&query=${encodeURIComponent(query)}`;
  try{ const res=await fetch(url); const data=await res.json(); return data.results?.filter(i=>i.media_type==='movie'||i.media_type==='tv')||[]; }
  catch(err){ console.error(err); return []; }
}

async function getTvDetails(tvId){
  const url=`https://api.themoviedb.org/3/tv/${tvId}?api_key=${tmdbApiKey}&language=it-IT`;
  try{ const res=await fetch(url); return await res.json(); }
  catch(err){ console.error(err); return null; }
}

async function setupTvControls(tvId){
  const controls=document.getElementById('tvControls');
  const seasonSelect=document.getElementById('seasonSelect');
  const episodeSelect=document.getElementById('episodeSelect');
  const player=document.getElementById('playerFrame');
  controls.style.display='flex';
  seasonSelect.innerHTML=''; episodeSelect.innerHTML='';
  const details=await getTvDetails(tvId);
  if(!details) return;
  details.seasons.forEach(season=>{
    if(season.season_number>0){
      const opt=document.createElement('option');
      opt.value=season.season_number;
      opt.textContent=`Stagione ${season.season_number}`;
      seasonSelect.appendChild(opt);
    }
  });
  async function updateEpisodes(seasonNumber){
    const url=`https://api.themoviedb.org/3/tv/${tvId}/season/${seasonNumber}?api_key=${tmdbApiKey}&language=it-IT`;
    const res=await fetch(url); const data=await res.json();
    episodeSelect.innerHTML='';
    data.episodes.forEach(ep=>{
      const opt=document.createElement('option');
      opt.value=ep.episode_number;
      opt.textContent=`Ep ${ep.episode_number}: ${ep.name}`;
      episodeSelect.appendChild(opt);
    });
    const firstEpisodeUrl=`https://vixsrc.to/tv/${tvId}/${seasonNumber}/${data.episodes[0].episode_number}`;
    player.src=firstEpisodeUrl;
    document.getElementById('downloadLink').href=firstEpisodeUrl;
  }
  updateEpisodes(seasonSelect.value);
  seasonSelect.addEventListener('change',()=>updateEpisodes(seasonSelect.value));
  episodeSelect.addEventListener('change',()=>{
    const season=seasonSelect.value;
    const episode=episodeSelect.value;
    player.src=`https://vixsrc.to/tv/${tvId}/${season}/${episode}`;
    document.getElementById('downloadLink').href=`https://vixsrc.to/tv/${tvId}/${season}/${episode}`;
  });
}

function createCard(item){
  const isMovie=item.media_type==='movie';
  const title=isMovie?item.title:item.name;
  const imgSrc=item.poster_path?`https://image.tmdb.org/t/p/w300${item.poster_path}`:'https://via.placeholder.com/300x450?text=No+Image';
  const card=document.createElement('div');
  card.className='card';
  card.innerHTML=`<img src="${imgSrc}" alt="${title}" loading="lazy"><h3>${title}</h3>`;
  card.addEventListener('click',()=>{
    document.getElementById('results').style.display='none';
    const playerPage=document.getElementById('playerPage');
    playerPage.style.display='flex';
    const player=document.getElementById('playerFrame');
    if(isMovie){
      const movieUrl=`https://vixsrc.to/movie/${item.id}`;
      player.src=movieUrl;
      document.getElementById('downloadLink').href=movieUrl;
      document.getElementById('tvControls').style.display='none';
    } else setupTvControls(item.id);
  });
  return card;
}

async function doSearch(){
  const query=document.getElementById('searchInput').value.trim();
  const resultsDiv=document.getElementById('results');
  const loadingDiv=document.getElementById('loading');
  if(!query) return;
  loadingDiv.style.display='block';
  resultsDiv.innerHTML=''; resultsDiv.style.display='grid';
  document.getElementById('playerPage').style.display='none';
  const mediaItems=await searchMedia(query);
  loadingDiv.style.display='none';
  if(!mediaItems.length){ resultsDiv.innerHTML='<p style="text-align:center;">Nessun risultato trovato.</p>'; return; }
  mediaItems.forEach(item=>resultsDiv.appendChild(createCard(item)));
}

document.getElementById('searchBtn').addEventListener('click',doSearch);
document.getElementById('searchInput').addEventListener('keydown',e=>{ if(e.key==='Enter') doSearch(); });
document.getElementById('backBtn').addEventListener('click',()=>{
  document.getElementById('playerPage').style.display='none';
  document.getElementById('results').style.display='grid';
});

document.addEventListener('DOMContentLoaded',()=>{
  if(!navigator.userAgent.toLowerCase().includes('brave')){
    alert("‚ö†Ô∏è Per evitare pubblicit√† fastidiose nel player, ti consigliamo di aprire il sito con il browser Brave.");
  }
});
</script>

</body>
</html>
